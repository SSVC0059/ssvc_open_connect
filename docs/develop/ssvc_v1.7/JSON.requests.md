## SSVC0059_V2 UART API — запросы и ответы

Документация к формату запросов и ответов.

### Общие правила

- **Запрос**:
  - Состоит из заглавных латинских букв, цифр и знака подчеркивания.
  - Заканчивается символом `\n` или `\r`.
- **Ответ**:
  - Передается в формате JSON в одной строке, заканчивающейся символом `\n`.

### Перечень запросов

- `AT`
- `NEXT`
- `PAUSE`
- `RESUME`
- `STOP`
- `START`
- `STATUS`
- `VERSION`
- `GET_SETTINGS`

---

## Общая структура сообщения с ответом

Сообщение с ответом на запрос содержит следующие поля:

- `type`: `"response"` — тип сообщения.
- `request`: полученная команда в кавычках.
- `result`: `"OK"` — при успешном выполнении команды, `"unknown"` — неизвестная команда.

Пример (обобщенный):

```json
{
  "type": "response",
  "request": "AT",
  "result": "OK"
}
```

---

## Описание запросов

### `AT`

- **Назначение**: тест обмена сообщениями.

---

### `NEXT`

- **Назначение**: действие, аналогичное нажатию кнопки «Далее/Выход» на этапах Головы / Тело / Хвосты.

---

### `PAUSE`

- **Назначение**: вход в режим ручного управления клапаном текущего этапа; клапан закрыт.

---

### `RESUME`

- **Назначение**: выход из режима ручного управления клапаном текущего этапа.

---

### `STOP`

- **Назначение**: удаленная остановка процесса на этапах Головы, Тело, Хвосты.

---

### `START`

- **Назначение**: удаленный запуск ректификации, работает только из дежурного режима.

---

### `STATUS`

- **Назначение**: передача статуса от подключенного устройства.
- **Формат**:
  - Принимается строка длиной 15 символов.
  - Полученное строковое значение отображается на дежурном экране.
- **Пример**:

  ```text
  STATUS 192.168.100.200
  ```

---

### `VERSION`

- **Назначение**: запрос версии прошивки.
- **Пример ответа**:

  ```json
  {
    "type": "response",
    "request": "VERSION",
    "result": "OK",
    "manufacturer": "SmartModule",
    "model": "SSVC0059_V2",
    "version": "2.2.37",
    "api": "1.0"
  }
  ```

---

### `GET_SETTINGS`

- **Назначение**: запрос настроек.
- **Описание**:
  - Ответ содержит поле `settings` — объект с набором параметров.
  - Пример JSON-структуры ниже включает все возможные поля, поддерживаемые версиями прошивки 2.2.* и 2.3.*.
  - Некоторые поля могут присутствовать только в одной из веток прошивок.

#### Пример ответа `GET_SETTINGS`

```json
{
  "type": "response",
  "request": "GET_SETTINGS",
  "result": "OK",
  "settings": {
    "heads": [24.5, 100],
    "heads_final": 15.0,
    "release_timer": 300,
    "release_speed": 99.9,
    "late_heads": [23.4, 123],
    "hearts": [2.5, 5],
    "hyst": 0.25,
    "decrement": 100,
    "tails": [2.1, 4],
    "sound": 0,
    "pressure": 1,
    "relay_inverted": 0,
    "relay_autostart": 0,
    "auto_mode": 1,
    "heads_timer": 900,
    "late_heads_timer": 1800,
    "hearts_timer": 0,
    "tails_temp": 95.9,
    "start_delay": 5,
    "hearts_finish_temp": 90.0,
    "parallel_v3": [
      [0.0, 0.4, 10],
      [81.0, 0.5, 11],
      [86.0, 0.6, 12],
      [96.0, 0.7, 13]
    ],
    "parallel_v1": [0.3, 10],
    "parallel": [0.2, 10],
    "hearts_temp_shift": 1,
    "hearts_pause": 1,
    "formula": 1,
    "formula_start_temp": 84.0,
    "tank_mmhg": 10,
    "tp2_shift": 0.0,
    "tp_filter": 0,
    "signal_tp1_control": 1,
    "signal_inverted": 0,
    "tp1_control_temp": 60,
    "tp1_control_start": 1,
    "stab_limit_time": 60,
    "stab_limit_finish": 1,
    "backlight": "active",
    "valve_bw": [1100, 1200, 1300]
  }
}
```

---

## Документация для JSON-структуры ответа на `GET_SETTINGS`

### Поля объекта `settings`

- **`heads`** — скорость отбора голов.
  - Формат: `[время открытого клапана, период]`
  - Время открытого клапана: время в секундах с точностью до 1 знака после десятичной точки.
  - Период: время в секундах.

- **`heads_final`** — скорость отбора к окончанию отбора голов, с. Актуально при опции «Сброс и снижение».

- **`release_timer`** — время сброса на этапе голов, с. Актуально при опции «Сброс и снижение».
  - Формат: целое число в секундах.

- **`release_speed`** — время открытого клапана для сброса, с; задает скорость отбора во время сброса.
  - Формат: число с одним знаком после десятичной точки.

- **`hearts`** — скорость отбора тела.
  - Формат: `[время открытого клапана, период]`
  - Время открытого клапана: время в секундах с точностью до 1 знака после десятичной точки.
  - Период: время в секундах, целое число.

- **`hyst`** — гистерезис при отборе тела, °C.

- **`decrement`** — декремент при отборе тела, %.

- **`late_heads`** — скорость отбора подголовников (актуально в firmware 2.3.*).
  - Формат: `[время открытого клапана, период]`
  - Время открытого клапана: время в секундах с точностью до 1 знака после десятичной точки.
  - Период: время в секундах.

- **`tails`** — скорость отбора хвостов (актуально в firmware 2.2.*).
  - Формат: `[время открытого клапана, период]`
  - Время открытого клапана: время в секундах с точностью до 1 знака после десятичной точки.
  - Период: время в секундах.

- **`sound`** — звук:
  - `1` — включено;
  - `0` — выключено.

- **`pressure`** — барометр:
  - `1` — включено;
  - `0` — выключено.

- **`relay_inverted`** — инвертировать реле:
  - `1` — включено;
  - `0` — выключено.

- **`relay_autostart`** — реле включить сразу:
  - `1` — включено;
  - `0` — выключено.

- **`auto_mode`** — автоматический переход между этапами:
  - `1` — включено;
  - `0` — выключено.

- **`heads_timer`** — время отбора голов, с.

- **`late_heads_timer`** — время отбора подголовников, с (актуально в firmware 2.3.*).

- **`hearts_timer`** — таймер фиксации температуры отбора тела, с.

- **`tails_temp`** — температура завершения отбора хвостов, °C (актуально в firmware 2.2.*).

- **`start_delay`** — отложенный пуск, с.

- **`hearts_finish_temp`** — температура ТД2 завершения отбора тела, °C.

- **`parallel_v3`** — скорость параллельного отбора клапаном №3 для 4 диапазонов (актуально в firmware 2.2.*).
  - Формат: `[[температура диапазона, время открытого клапана, период], ...]`
  - Температура диапазона: температура в °C.
  - Время открытого клапана: время в секундах с точностью до 1 знака после десятичной точки.
  - Период: время в секундах.

- **`parallel_v1`** — скорость параллельного отбора клапаном №1 (актуально в firmware 2.2.*).
  - Формат: `[время открытого клапана, период]`
  - Время открытого клапана: время в секундах с точностью до 1 знака после десятичной точки.
  - Период: время в секундах.

- **`parallel`** — скорость параллельного отбора клапаном №3 (актуально в firmware 2.3.*).
  - Формат: `[время открытого клапана, период]`
  - Время открытого клапана: время в секундах с точностью до 1 знака после десятичной точки.
  - Период: время в секундах.

- **`hearts_temp_shift`** — сдвиг температуры отбора тела на `0.07` °C:
  - `1` — включено;
  - `0` — выключено.

- **`hearts_pause`** — пауза «на себя»:
  - `1` — включено;
  - `0` — выключено.

- **`formula`** — формула:
  - `1` — включено;
  - `0` — выключено.

- **`formula_start_temp`** — температура начала формулы, °C.

- **`tank_mmhg`** — давление в кубе, мм рт. ст.

- **`tp2_shift`** — поправка ТД2, °C.

- **`tp_filter`** — фильтр ТД:
  - `1` — включено;
  - `0` — выключено.

- **`signal_tp1_control`** — контроль ТД1 для выхода `SIGNAL`:
  - `1` — включено;
  - `0` — выключено.

- **`signal_inverted`** — инвертировать `SIGNAL`:
  - `1` — включено;
  - `0` — выключено.

- **`tp1_control_temp`** — целевая температура на ТД1 при контроле ТД1 для выхода `SIGNAL`, °C.

- **`tp1_control_start`** — старт по ТД1 при контроле ТД1 для выхода `SIGNAL`:
  - `1` — включено;
  - `0` — выключено.

- **`stab_limit_time`** — лимит стабилизации, с (`0` — отключен).

- **`stab_limit_finish`** — завершить этап при превышении лимита стабилизации:
  - `1` — включено;
  - `0` — выключено.

- **`backlight`** — подсветка дисплея.
  - Возможные значения:
    - `"active"` — включено;
    - `"always"` — всегда включено;
    - `"off"` — выключено.

- **`valve_bw`** — пропускная способность клапанов.
  - Формат: `[клапан 1, клапан 2, клапан 3]`
  - Значения: пропускная способность в мл/ч соответствующего клапана.


